<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì–´ë¦°ì´ í…ŒíŠ¸ë¦¬ìŠ¤</title>
    <style>
        /* ğŸ¨ CSS: ê²Œì„ í™”ë©´ ë””ìì¸ */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #f0f0f0;
            font-family: 'Arial', sans-serif;
        }
        .game-container {
            display: flex;
            gap: 20px;
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        #game-board {
            border: 5px solid #333;
            background-color: #000;
        }
        .info-panel {
            width: 150px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .info-box {
            padding: 10px;
            border: 2px solid #ccc;
            border-radius: 5px;
            background-color: #e9e9e9;
        }
        #next-block-canvas {
            border: 1px solid #aaa;
            background-color: #333;
        }
        h2 {
            margin-top: 0;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <canvas id="game-board" width="300" height="600"></canvas>
        <div class="info-panel">
            <div class="info-box">
                <h2>ì ìˆ˜</h2>
                <div id="score">0</div>
            </div>
            <div class="info-box">
                <h2>ë ˆë²¨</h2>
                <div id="level">1</div>
            </div>
            <div class="info-box">
                <h2>ë‹¤ìŒ ë¸”ë¡</h2>
                <canvas id="next-block-canvas" width="120" height="120"></canvas>
            </div>
            <div class="info-box">
                <p>â† â†’: ì´ë™</p>
                <p>â†‘: íšŒì „</p>
                <p>â†“: ë¹ ë¥´ê²Œ ë‚´ë¦¬ê¸°</p>
            </div>
        </div>
    </div>

    <script>
        // ğŸš€ JAVASCRIPT: ê²Œì„ ë¡œì§
        const BOARD_COLS = 10;
        const BOARD_ROWS = 20;
        const BLOCK_SIZE = 30;
        
        // ìº”ë²„ìŠ¤ ì„¤ì •
        const boardCanvas = document.getElementById('game-board');
        const boardCtx = boardCanvas.getContext('2d');
        const nextCanvas = document.getElementById('next-block-canvas');
        const nextCtx = nextCanvas.getContext('2d');

        // ì ìˆ˜/ë ˆë²¨ í‘œì‹œ ìš”ì†Œ
        const scoreElement = document.getElementById('score');
        const levelElement = document.getElementById('level');

        // ë¸”ë¡ ëª¨ì–‘ (ê°„ì†Œí™”)
        const SHAPES = [
            [[1, 1, 1, 1], [0]],                 // I
            [[1, 1], [1, 1]],                     // O
            [[0, 1, 0], [1, 1, 1]],               // T
            [[1, 1, 0], [0, 1, 1]],               // Z
            [[0, 1, 1], [1, 1, 0]],               // S
            [[1, 0, 0], [1, 1, 1]],               // J
            [[0, 0, 1], [1, 1, 1]]                // L
        ];
        const COLORS = ['cyan', 'yellow', 'purple', 'red', 'green', 'blue', 'orange'];

        let board = Array.from({ length: BOARD_ROWS }, () => Array(BOARD_COLS).fill(0));
        let score = 0;
        let level = 1;
        let currentPiece, nextPiece;
        let dropCounter = 0;
        let dropInterval = 1000; // ë¸”ë¡ì´ ë–¨ì–´ì§€ëŠ” ê¸°ë³¸ ì‹œê°„ (1ì´ˆ)
        let lastTime = 0;
        let startTime = Date.now(); // ê²Œì„ ì‹œì‘ ì‹œê°„

        // --- ë¸”ë¡ í´ë˜ìŠ¤ ë° í•¨ìˆ˜ (ê°„ì†Œí™”) ---
        class Piece {
            constructor(shape, color) {
                this.shape = shape;
                this.color = color;
                this.x = Math.floor(BOARD_COLS / 2) - Math.floor(shape[0].length / 2);
                this.y = 0;
            }

            rotate() {
                // ì‹œê³„ ë°©í–¥ 90ë„ íšŒì „
                const N = this.shape.length;
                let newShape = this.shape.map((row, i) => row.map((_, j) => this.shape[N - 1 - j][i]));
                this.shape = newShape;
            }
        }

        function newPiece() {
            const randIndex = Math.floor(Math.random() * SHAPES.length);
            const shape = SHAPES[randIndex];
            const color = COLORS[randIndex];
            return new Piece(shape, color);
        }

        function drawBlock(ctx, x, y, color) {
            ctx.fillStyle = color;
            ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
            ctx.strokeStyle = 'black';
            ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
        }

        function drawPiece(ctx, piece, offsetX = 0, offsetY = 0) {
            piece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        drawBlock(ctx, piece.x + x + offsetX, piece.y + y + offsetY, piece.color);
                    }
                });
            });
        }

        function validMove(newX, newY, newShape) {
            for (let y = 0; y < newShape.length; y++) {
                for (let x = 0; x < newShape[y].length; x++) {
                    if (newShape[y][x]) {
                        let finalX = newX + x;
                        let finalY = newY + y;

                        // ê²½ê³„ì„  ë° ë‹¤ë¥¸ ë¸”ë¡ê³¼ì˜ ì¶©ëŒ í™•ì¸
                        if (finalX < 0 || finalX >= BOARD_COLS || finalY >= BOARD_ROWS || (finalY < BOARD_ROWS && finalY >= 0 && board[finalY][finalX] !== 0)) {
                            return false;
                        }
                    }
                }
            }
            return true;
        }

        function merge() {
            currentPiece.shape.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        board[currentPiece.y + y][currentPiece.x + x] = currentPiece.color;
                    }
                });
            });
        }

        function checkLines() {
            let linesCleared = 0;
            for (let y = BOARD_ROWS - 1; y >= 0; y--) {
                if (board[y].every(cell => cell !== 0)) {
                    // ì¤„ì´ ê°€ë“ ì°¼ìœ¼ë©´
                    linesCleared++;
                    // í•´ë‹¹ ì¤„ì„ ì œê±°í•˜ê³ 
                    const row = board.splice(y, 1)[0].fill(0);
                    // ë§¨ ìœ„ì— ìƒˆë¡œìš´ ë¹ˆ ì¤„ì„ ì¶”ê°€
                    board.unshift(row);
                    y++; // ì œê±°ëœ ì¤„ì˜ ìœ„ì¹˜ë¶€í„° ë‹¤ì‹œ ê²€ì‚¬í•˜ê¸° ìœ„í•´ yë¥¼ ì¦ê°€
                }
            }
            if (linesCleared > 0) {
                // ì¤„ ì‚­ì œì— ë”°ë¥¸ ì ìˆ˜ ê³„ì‚°
                score += linesCleared * 100 * level; // ë ˆë²¨ì— ë”°ë¼ ì ìˆ˜ ì¦ê°€
                scoreElement.textContent = score;
            }
        }

        function updateLevel() {
            const elapsedTime = (Date.now() - startTime) / 1000; // ì´ˆ ë‹¨ìœ„
            const newLevel = 1 + Math.floor(elapsedTime / 30); // 30ì´ˆë§ˆë‹¤ ë ˆë²¨ì—…
            
            if (newLevel !== level) {
                level = newLevel;
                levelElement.textContent = level;
                // ğŸš€ ì†ë„ ì¦ê°€: ë ˆë²¨ì´ ì˜¬ë¼ê°ˆìˆ˜ë¡ dropIntervalì„ ì¤„ì„ (ìµœì†Œ 100ms)
                dropInterval = Math.max(100, 1000 * (0.8 ** (level - 1)));
            }
        }

        // --- ë©”ì¸ ë£¨í”„ ---
        function gameLoop(time = 0) {
            const deltaTime = time - lastTime;
            lastTime = time;
            
            updateLevel(); // ì‹œê°„ ê²½ê³¼ì— ë”°ë¥¸ ë ˆë²¨ ë° ì†ë„ ì—…ë°ì´íŠ¸

            dropCounter += deltaTime;
            if (dropCounter > dropInterval) {
                if (validMove(currentPiece.x, currentPiece.y + 1, currentPiece.shape)) {
                    currentPiece.y++;
                } else {
                    // ë¸”ë¡ ê³ ì •
                    merge();
                    checkLines();
                    currentPiece = nextPiece;
                    nextPiece = newPiece();
                    
                    // ê²Œì„ ì˜¤ë²„ ì²´í¬ (ìƒˆ ë¸”ë¡ì´ ì‹œì‘í•˜ìë§ˆì ì¶©ëŒí•˜ë©´)
                    if (!validMove(currentPiece.x, currentPiece.y, currentPiece.shape)) {
                        alert(`ê²Œì„ ì˜¤ë²„! ìµœì¢… ì ìˆ˜: ${score}`);
                        return; // ê²Œì„ ë£¨í”„ ì¢…ë£Œ
                    }
                }
                dropCounter = 0;
            }

            // ê·¸ë¦¬ê¸°
            boardCtx.fillStyle = '#000';
            boardCtx.fillRect(0, 0, boardCanvas.width, boardCanvas.height);
            
            // ìŒ“ì¸ ë¸”ë¡ ê·¸ë¦¬ê¸°
            board.forEach((row, y) => {
                row.forEach((value, x) => {
                    if (value) {
                        drawBlock(boardCtx, x, y, value);
                    }
                });
            });

            // í˜„ì¬ ë¸”ë¡ ê·¸ë¦¬ê¸°
            drawPiece(boardCtx, currentPiece);

            // ë‹¤ìŒ ë¸”ë¡ ê·¸ë¦¬ê¸°
            nextCtx.fillStyle = '#333';
            nextCtx.fillRect(0, 0, nextCanvas.width, nextCanvas.height);
            // ë‹¤ìŒ ë¸”ë¡ì„ ìº”ë²„ìŠ¤ ì¤‘ì•™ì— í‘œì‹œí•˜ê¸° ìœ„í•´ ìœ„ì¹˜ ì¡°ì •
            drawPiece(nextCtx, nextPiece, (6 - nextPiece.shape[0].length) / 2, (6 - nextPiece.shape.length) / 2);

            requestAnimationFrame(gameLoop); // ë‹¤ìŒ í”„ë ˆì„ ìš”ì²­
        }

        // --- ì‚¬ìš©ì ì…ë ¥ (í‚¤ë³´ë“œ ì´ë²¤íŠ¸) ---
        document.addEventListener('keydown', event => {
            if (event.key === 'ArrowLeft') {
                if (validMove(currentPiece.x - 1, currentPiece.y, currentPiece.shape)) currentPiece.x--;
            } else if (event.key === 'ArrowRight') {
                if (validMove(currentPiece.x + 1, currentPiece.y, currentPiece.shape)) currentPiece.x++;
            } else if (event.key === 'ArrowDown') {
                // ì•„ë˜ í‚¤ë¥¼ ëˆ„ë¥´ë©´ ë°”ë¡œ í•œ ì¹¸ ë–¨ì–´ì§€ê³ , dropCounter ì´ˆê¸°í™”ë¡œ ë¹ ë¥´ê²Œ ë–¨ì–´ì§€ëŠ” ëŠë‚Œ êµ¬í˜„
                if (validMove(currentPiece.x, currentPiece.y + 1, currentPiece.shape)) currentPiece.y++;
                dropCounter = 0;
            } else if (event.key === 'ArrowUp') {
                // íšŒì „ ì‹œë„
                const originalShape = currentPiece.shape;
                currentPiece.rotate();
                // íšŒì „ í›„ ìœ íš¨ì„± ê²€ì‚¬ (ë²½ ë¼ì„ ë°©ì§€ ë“± ë³µì¡í•œ ë¡œì§ì€ ìƒëµ)
                if (!validMove(currentPiece.x, currentPiece.y, currentPiece.shape)) {
                    currentPiece.shape = originalShape; // ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ì›ë˜ëŒ€ë¡œ ë˜ëŒë¦¼
                }
            }
        });

        // --- ê²Œì„ ì‹œì‘ ---
        currentPiece = newPiece();
        nextPiece = newPiece();
        gameLoop();
    </script>
</body>
</html>